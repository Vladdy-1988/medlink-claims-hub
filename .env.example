# Environment Configuration for MedLink Claims Hub
# ============================================
# Copy this file to .env and fill in your values
# DO NOT commit .env to version control
# Generate secure secrets with: openssl rand -base64 32

# ============================================
# APPLICATION CORE
# ============================================
NODE_ENV=production  # Options: development, staging, production
PORT=5000
APP_URL=http://localhost:5000  # Full URL for emails, links, etc.

# ============================================
# DATABASE (Required)
# ============================================
DATABASE_URL=postgresql://username:password@host:port/database?sslmode=require
# Optional database pool settings
DATABASE_MAX_CONNECTIONS=20
DATABASE_CONNECTION_TIMEOUT=10000

# ============================================
# AUTHENTICATION
# ============================================
# Replit OIDC (Required for Replit deployment)
ISSUER_URL=https://replit.com/oidc
REPLIT_DB_URL=
REPL_ID=
REPL_SLUG=
REPLIT_DOMAINS=your-domain.replit.dev

# Session Security (Generate with: openssl rand -base64 32)
SESSION_SECRET=your-session-secret-min-32-chars

# SSO Integration (for marketplace)
SSO_SHARED_SECRET=your-sso-shared-secret-min-32-chars

# ============================================
# OBJECT STORAGE
# ============================================
STORAGE_MODE=local  # Options: local, cloud

# Local Storage (when STORAGE_MODE=local)
STORAGE_DIR=./uploads

# Google Cloud Storage
GOOGLE_CLOUD_PROJECT_ID=
GOOGLE_CLOUD_STORAGE_BUCKET=
GOOGLE_APPLICATION_CREDENTIALS=

# S3-Compatible Storage (AWS S3, Cloudflare R2)
S3_ENDPOINT=https://your-endpoint.r2.cloudflarestorage.com
S3_BUCKET=your-bucket-name
S3_ACCESS_KEY_ID=your-access-key
S3_SECRET_ACCESS_KEY=your-secret-key
S3_REGION=auto

# Object Storage Paths
PUBLIC_OBJECT_SEARCH_PATHS=/api/files/public
PRIVATE_OBJECT_DIR=private

# ============================================
# MONITORING & OBSERVABILITY
# ============================================
# Logging
ENABLE_METRICS=true
LOG_LEVEL=info  # Options: debug, info, warn, error, fatal
LOG_FORMAT=json  # Options: json, pretty

# Sentry Error Tracking (leave empty to disable)
SENTRY_DSN=https://your-key@sentry.io/project-id
SENTRY_ENV=staging  # Options: development, staging, production
SENTRY_TRACES_SAMPLE_RATE=0.1  # 10% of transactions
SENTRY_PROFILES_SAMPLE_RATE=0.1  # 10% of profiles

# Frontend Sentry (must be prefixed with VITE_)
VITE_SENTRY_DSN=https://your-key@sentry.io/project-id
VITE_SENTRY_ENV=production
VITE_APP_VERSION=1.0.0

# ============================================
# PUSH NOTIFICATIONS (PWA)
# ============================================
# Generate at https://vapidkeys.com
VAPID_PUBLIC_KEY=your-vapid-public-key
VAPID_PRIVATE_KEY=your-vapid-private-key
VAPID_EMAIL=mailto:support@medlinkclaims.com

# ============================================
# SECURITY
# ============================================
# Field-Level Encryption for PHI Data
# Generate with: openssl rand -base64 32
ENCRYPTION_KEY=your-encryption-key-min-32-chars-required-for-phi-protection
ENCRYPTION_ALGORITHM=aes-256-gcm
ENCRYPTION_KEY_VERSION=1  # Increment when rotating keys
ENCRYPTION_PBKDF2_ITERATIONS=100000  # Key derivation iterations

# Searchable Hash Key for HMAC Operations
# CRITICAL: HASH_KEY must NOT equal ENCRYPTION_KEY
# Generate with: openssl rand -base64 32
HASH_KEY=your-hash-key-min-32-chars-MUST-BE-DIFFERENT-from-encryption-key

# Outbound Network Allowlist for Sandbox Mode
# Comma-separated list of allowed hosts/patterns for EDI connectors
OUTBOUND_ALLOWLIST=localhost,127.0.0.1,sandbox.,test.,mock.,cdn.,api-staging.

# CORS Configuration
ALLOWED_ORIGINS=http://localhost:5000,https://your-domain.com
CORS_ORIGIN=

# Rate Limiting
RATE_LIMIT_WINDOW_MS=60000  # 1 minute
RATE_LIMIT_MAX_REQUESTS=100  # Per window

# CSRF Protection
CSRF_SECRET=your-csrf-secret-min-32-chars

# Security Headers
ALLOWED_HOSTS=localhost,your-domain.com
CSP_REPORT_URI=https://your-csp-report-endpoint.com

# ============================================
# EDI CONNECTORS (Healthcare APIs)
# ============================================
# EDI Mode Configuration (CRITICAL: Always use sandbox unless in production)
EDI_MODE=sandbox  # Options: sandbox, production (DANGER: production sends real claims)
EDI_BLOCK_PRODUCTION=true  # Force block all production endpoints (safety net)
EDI_PRODUCTION_CONFIRMED=false  # Must be explicitly set to true for production EDI
EDI_NETWORK_ALLOWLIST=localhost,*.sandbox.test,*.development.local
EDI_RESPONSE_DELAY_MS=2000  # Simulated processing time in sandbox
EDI_SANDBOX_PREFIX=SANDBOX  # Prefix for all sandbox identifiers
EDI_ERROR_RATE=0.05  # Simulated error rate (5%) for testing
EDI_AUDIT_ENABLED=true  # Log all EDI attempts for compliance

# Production API Keys (only used when EDI_MODE=production)
TELUS_API_KEY=
CDANET_API_KEY=
SUNLIFE_API_KEY=
MANULIFE_API_KEY=
BLUECROSS_API_KEY=

# ============================================
# COMPLIANCE & REGULATORY
# ============================================
# Data Retention (days)
DATA_RETENTION_CLAIMS=2555  # 7 years for HIPAA
DATA_RETENTION_AUDIT_LOGS=2190  # 6 years
DATA_RETENTION_SESSIONS=30

# Privacy Officer
PRIVACY_OFFICER_NAME=John Doe
PRIVACY_OFFICER_EMAIL=privacy@medlinkclaims.com
PRIVACY_POLICY_URL=https://medlinkclaims.com/privacy

# ============================================
# BACKUP & DISASTER RECOVERY
# ============================================
BACKUP_ENABLED=false
BACKUP_S3_BUCKET=medlink-backups
BACKUP_ENCRYPTION_KEY=your-backup-encryption-key
BACKUP_SCHEDULE="0 2 * * *"  # Daily at 2 AM

# ============================================
# FEATURE FLAGS
# ============================================
FEATURE_EDI_CONNECTORS=false
FEATURE_PUSH_NOTIFICATIONS=false
FEATURE_AI_ASSISTANCE=false
FEATURE_ANALYTICS=false

# ============================================
# PERFORMANCE
# ============================================
NODE_OPTIONS=--max-old-space-size=4096
WORKER_THREADS=4
JOB_QUEUE_CONCURRENCY=5
CACHE_TTL=3600  # 1 hour